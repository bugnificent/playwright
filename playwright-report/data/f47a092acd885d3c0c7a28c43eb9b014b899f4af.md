# Test info

- Name: Visual and Accessibility Tests >> @smoke - Visual Regression
- Location: C:\Users\Velespit\Playwright Project\visual-accessibility.spec.ts:67:5

# Error details

```
Error: expect(page).toHaveScreenshot(expected)

  Expected an image 1280px by 9610px, received 1280px by 9681px. 823193 pixels (ratio 0.07 of all image pixels) are different.

Expected: C:\Users\Velespit\Playwright Project\visual-accessibility.spec.ts-snapshots\Visual-and-Accessibility-Tests-smoke---Visual-Regression-1-Microsoft-Edge-win32.png
Received: C:\Users\Velespit\Playwright Project\test-results\visual-accessibility-Visua-ec906-s-smoke---Visual-Regression-Microsoft-Edge-retry2\Visual-and-Accessibility-Tests-smoke---Visual-Regression-1-actual.png
    Diff: C:\Users\Velespit\Playwright Project\test-results\visual-accessibility-Visua-ec906-s-smoke---Visual-Regression-Microsoft-Edge-retry2\Visual-and-Accessibility-Tests-smoke---Visual-Regression-1-diff.png

Call log:
  - expect.toHaveScreenshot with timeout 5000ms
    - verifying given screenshot expectation
  - taking page screenshot
    - disabled all CSS animations
  - waiting for fonts to load...
  - fonts loaded
  - Expected an image 1280px by 9610px, received 1280px by 9681px. 716272 pixels (ratio 0.06 of all image pixels) are different.
  - waiting 100ms before taking screenshot
  - taking page screenshot
    - disabled all CSS animations
  - waiting for fonts to load...
  - fonts loaded
  - captured a stable screenshot
  - Expected an image 1280px by 9610px, received 1280px by 9681px. 823193 pixels (ratio 0.07 of all image pixels) are different.

    at C:\Users\Velespit\Playwright Project\visual-accessibility.spec.ts:90:22
```

# Test source

```ts
   1 | import { test, expect } from '@playwright/test';
   2 | import { injectAxe, checkA11y } from 'axe-playwright';
   3 |
   4 | test.describe('Visual and Accessibility Tests', () => {
   5 |   test.use({
   6 |     // Can use specific viewport size for consistent visual regression testing
   7 |        viewport: { width: 1280, height: 800 },
   8 |     // Specific user agent string if needed
   9 |     // userAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3',
   10 |   });
   11 |
   12 |   test.beforeEach(async ({ page }) => {
   13 |     // Navigate to the website
   14 |     await page.goto('https://yusufasik.com');
   15 |
   16 |   });
   17 |
   18 |   test.afterEach(async ({ page }) => {
   19 |     // Close the page after each test
   20 |     await page.close();
   21 |   });
   22 |
   23 | test('@smoke - Accessibility', async ({ page }) => {
   24 |
   25 |   // Inject axe-core into the page
   26 |   await injectAxe(page);
   27 |
   28 |   // Scroll through the page to trigger lazy loading
   29 |   await page.evaluate(() => {
   30 |     return new Promise<void>((resolve) => {
   31 |       let totalHeight = 0;
   32 |       const distance = 100;
   33 |       const timer = setInterval(() => {
   34 |         const scrollHeight = document.body.scrollHeight;
   35 |         window.scrollBy(0, distance);
   36 |         totalHeight += distance;
   37 |
   38 |         if (totalHeight >= scrollHeight) {
   39 |           clearInterval(timer);
   40 |           resolve();
   41 |         }
   42 |       }, 300);// Adjust the interval as needed, scroll every 300ms
   43 |     });
   44 |   });
   45 |
   46 |   // Additional safety measures
   47 |   await page.waitForLoadState('networkidle'); // Waits for network inactivity
   48 |   await page.waitForTimeout(500); // Small buffer for final rendering
   49 |
   50 |   try{
   51 |     // Check for accessibility issues
   52 |     await checkA11y(page, {
   53 |       detailedReport: true,
   54 |       detailedReportOptions: { html: true },
   55 |       // includeImpacts: ['critical', 'serious', 'moderate'], 
   56 |       // Not to fail the test on accessibility errors, good for CI/CD but not working all the time skipFailures: true, 
   57 |       axeOptions: {
   58 |         runOnly: ['wcag21aa'], // Run only specific rules
   59 |       }
   60 |     });
   61 |   } catch (error) {
   62 |     console.error('Accessibility check failed:', error);
   63 |   }
   64 |
   65 | });
   66 |
   67 | test('@smoke - Visual Regression', async ({ page }) => {
   68 |
   69 |   // Handle all lazy-loaded images
   70 |   const hoverElements = await page.getByRole('link', { name: 'mail' }).all();
   71 |   for (const element of hoverElements) {
   72 |     await element.scrollIntoViewIfNeeded(); // Makes each image visible
   73 |     await element.waitFor({ state: 'visible' }); // Waits for load completion
   74 |   }
   75 |
   76 |   /*
   77 |   // Handle hover-activated elements if any
   78 |     const hoverElements = await page.getByRole('link', { name: 'mail' }).all();
   79 |     for (const el of hoverElements) {
   80 |       await el.hover();
   81 |       await page.waitForTimeout(500); // Adjust based on your animations
   82 |     }
   83 |       */
   84 |
   85 |   // Additional safety measures
   86 |   await page.waitForLoadState('networkidle'); // Waits for network inactivity
   87 |   await page.waitForTimeout(500); // Small buffer for final rendering
   88 |
   89 |   // Take a full page screenshot and mask out dynamic elements
>  90 |   await expect(page).toHaveScreenshot({
      |                      ^ Error: expect(page).toHaveScreenshot(expected)
   91 |     fullPage: true,
   92 |     animations: 'disabled',
   93 |     mask: [
   94 |       page.locator('[data-test="titles"]:nth-of-type(1)'), // Replace with the selector of the dynamic element
   95 |     ],
   96 |     maxDiffPixelRatio: 0.01, // 0.2 can miss some differences
   97 |   });
   98 | });
   99 |
  100 | });
```